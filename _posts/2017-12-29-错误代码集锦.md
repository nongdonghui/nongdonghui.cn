---
layout: post
title: 错误代码集锦
categories: java
---

## {{ page.title }}

{{ page.date | date: "%Y.%-m.%-d" }} | <a href="/archive#{{ page.categories }}">{{ page.categories}}</a>

1.

错误信息:

```
2017-12-29 02:14:31 [http-8080-1] [com.justep.business.server.BusinessServer] ERROR: excute stream action, params:{"accept":"application/json",
"action":"queryProdOrderMatListWithoutJointProdAction","actionFlag":"__action_0__","activity":"mainActivity","contentType":"json","executeContext":"",
"executor":"","parameters":{"isCalc":true,"masterId":"AF51E6ACB02D4393B2C00485D65BC466","quantity":"[Decimal:undefined]","unit":"KG"},
"process":"/eppenpf/pp/process/prodOrder/prodOrderProcess"}
java.lang.NumberFormatException
	at java.math.BigDecimal.<init>(BigDecimal.java:494)
	at java.math.BigDecimal.<init>(BigDecimal.java:383)
	at java.math.BigDecimal.<init>(BigDecimal.java:806)
	at com.justep.system.transform.SimpleTransform.a(Unknown Source)
	at com.justep.system.transform.SimpleTransform.transToObj(Unknown Source)
	at com.justep.system.transform.SimpleTransform.transJsonToObject(Unknown Source)
	at com.justep.system.transform.ParameterTransform.transParamByJson(Unknown Source)
	at com.justep.system.transform.ParameterTransform.helpTransform(Unknown Source)
	at com.justep.system.transform.ParameterTransform.transform(Unknown Source)
	at com.justep.system.transform.RequestTransform.transParamValue(Unknown Source)
	at com.justep.system.transform.RequestTransform.transActionParams(Unknown Source)
	at com.justep.system.transform.RequestTransform.transform(Unknown Source)
	at com.justep.system.action.Engine.translateParameters(Unknown Source)
	at com.justep.system.action.Engine.invokeActions(Native Method)
	at com.justep.system.action.Engine.invokeActions(Unknown Source)
	at com.justep.business.server.BusinessServer.doAction(Unknown Source)
	at com.justep.business.server.BusinessServer.doExcute(Unknown Source)
	at com.justep.business.server.BusinessServer.excute(Unknown Source)
	at com.justep.business.server.BusinessServer.excute(Unknown Source)
	at com.justep.business.server.BusinessServerServlet.execService(Unknown Source)
	at com.justep.business.server.BusinessServerServlet.service(Unknown Source)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:723)
	at com.justep.x.bs.BusinessServerServlet.service(Unknown Source)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:723)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)
	at com.googlecode.psiprobe.Tomcat60AgentValve.invoke(Tomcat60AgentValve.java:40)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:103)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:293)
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:861)
	at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:606)
	at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:489)
	at java.lang.Thread.run(Thread.java:745)
```

原因: 前台的调用action参数quantity: param.setDecimal("quantity", mainData.getValue("CONFIRM_QUANTITY")); 当mainData.getValue没有赋值时,为undefined导致类型转换失败
说明: 当传输数据时,必须进行校验,哪些必须有值,哪些可以没有值

2.

错误信息:

```
2017-12-28 22:41:08 [http-8080-2] [com.justep.business.server.BusinessServer] ERROR: excute stream action, params:{"accept":"application/json",
"action":"confirmApportionmentAction","actionFlag":"__action_0__","activity":"mainActivity","contentType":"json","executeContext":"","executor":"",
"parameters":{"detailIds":["22FBB334FA6B449BBBAE623A7368B0AA","26529C371A824FFA87721E6A1821912F","2D40988E31B84D44995ACDEBA278C500","6081CEEF218D413997BA20C0B644909C",
"90044BFE225840398A47608904EAB1BB","50C181356BEB43B1942E6F5A935FA8F9","F399CF84B5254F31BBDB79F208A4C47A"],"header":{"DOC_DATE":"[DateTime:2017-12-28T00:00:00.000Z]",
"HEADER_TXT":"生产订单确认分摊","MOVE_TYPE":"261","PSTNG_DATE":"[DateTime:2017-12-28T00:00:00.000Z]","id":"F275B7C588584591AD48EFC491EAD3D5"}},
"process":"/eppenpf/pp/process/confirmApportionment/confirmApportionmentProcess"}
java.lang.reflect.InvocationTargetException
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:497)
	at com.justep.system.action.Engine.invokeActions(Native Method)
	at com.justep.system.action.Engine.invokeActions(Unknown Source)
	at com.justep.business.server.BusinessServer.doAction(Unknown Source)
	at com.justep.business.server.BusinessServer.doExcute(Unknown Source)
	at com.justep.business.server.BusinessServer.excute(Unknown Source)
	at com.justep.business.server.BusinessServer.excute(Unknown Source)
	at com.justep.business.server.BusinessServerServlet.execService(Unknown Source)
	at com.justep.business.server.BusinessServerServlet.service(Unknown Source)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:723)
	at com.justep.x.bs.BusinessServerServlet.service(Unknown Source)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:723)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)
	at com.googlecode.psiprobe.Tomcat60AgentValve.invoke(Tomcat60AgentValve.java:40)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:103)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:293)
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:861)
	at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:606)
	at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:489)
	at java.lang.Thread.run(Thread.java:745)
Caused by: java.lang.RuntimeException: 操作失败,没有数据
	at Confirm.confirmApportionment(Confirm.java:326)
	... 28 more
```

代码信息:

```
public static Map<String, Object> confirmApportionment(Map header, List detailIds) throws JCoException {
	Map<String, Object> tips = new HashMap<String, Object>();
	tips.put(Constants.FLAG, false);
	
	String concept = "D_PP_CONFIRM_APPORTIONMENT1";
	
	String sql = "SELECT id.* FROM " + concept + " id WHERE id in(" + CommonBuilder.buildSqlInCondition(detailIds) + ")";
	Table table = KSQL.select(sql, null, ppDataModel, null);	
	
	if (table.size() == 0) {
		throw new RuntimeException("操作失败,没有数据"); // Confirm.java:326
	} else {
```

原因: 前台数据没有保存, 直接提交调用后台action, 导致后台查询不到数据
说明: 当后台有根据前台查询的, 必须确保数据已经保存

3.

错误信息:

```
2017-12-29 09:12:14 [http-8080-2] [com.justep.business.server.BusinessServer] ERROR: excute stream action, params:{"accept":"application/json",
"action":"REQUIREMENTS_SHEET","actionFlag":"__action_0__","activity":"mainActivity","contentType":"json","executeContext":"","executor":"",
"parameters":{},"process":"/eppenpf/pp/process/demand/demandProcess"}
java.lang.reflect.InvocationTargetException
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:497)
	at com.justep.system.action.Engine.invokeActions(Native Method)
	at com.justep.system.action.Engine.invokeActions(Unknown Source)
	at com.justep.business.server.BusinessServer.doAction(Unknown Source)
	at com.justep.business.server.BusinessServer.doExcute(Unknown Source)
	at com.justep.business.server.BusinessServer.excute(Unknown Source)
	at com.justep.business.server.BusinessServer.excute(Unknown Source)
	at com.justep.business.server.BusinessServerServlet.execService(Unknown Source)
	at com.justep.business.server.BusinessServerServlet.service(Unknown Source)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:723)
	at com.justep.x.bs.BusinessServerServlet.service(Unknown Source)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:723)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)
	at com.googlecode.psiprobe.Tomcat60AgentValve.invoke(Tomcat60AgentValve.java:40)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:103)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:293)
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:861)
	at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:606)
	at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:489)
	at java.lang.Thread.run(Thread.java:745)
Caused by: java.lang.NullPointerException
	at Pp.REQUIREMENTS_SHEET(Pp.java:2963)
	... 28 more
```

对应的代码如下: 

```
public static void REQUIREMENTS_SHEET() {

	String dataModel = "/eppenpf/pp/data";

	String sql = "SELECT max(id.MON) as M FROM REQUIREMENTS_SHEET id ";

	Table ta = KSQL.select(sql, null, dataModel, null);
	String MON = "";

	if (ta.size() != 0) {
		Iterator<Row> r1 = ta.iterator();

		while (r1.hasNext()) {
			Row re = r1.next();
			MON = re.getString("M");
		}
	}

	String sq = "SELECT max(id.PERIO) as M FROM D_PROD_PLAN_DETAIL_LIST id ";

	Table table = KSQL.select(sq, null, dataModel, null);
	String MONS = "";
	if (table.size() != 0) {
		Iterator<Row> r = table.iterator();

		while (r.hasNext()) {
			Row re = r.next();
			MONS = re.getString("M");
		}
	}
	HashMap<String, Object> var = new HashMap<String, Object>();

	Calendar cal = Calendar.getInstance();
	int year = cal.get(Calendar.YEAR);
	int month = cal.get(Calendar.MONTH) + 1;

	String mo = year + "" + month;

	if (MONS != "" && MONS != null) {

		if (MON.equals(MONS)) { // Pp.java:2963  当sql或sq查询返回空时,即MON=null,此处报Caused by: java.lang.NullPointerException at Pp.REQUIREMENTS_SHEET(Pp.java:2963)
	......
```

说明: String判断空时,必须判断str != null && !"".equals(str), 直接str != ""是错误的

4.

代码信息:

```
public static void sheetSQL(HashMap<String, Object> var) {

	String dataModel = "/eppenpf/pp/data";

	String sqls = "SELECT sum(id.CONSUMPTION) as CONSUMPTION,id.PERIO,id.WERKS,id.MATNR FROM D_PROD_PLAN_DETAIL_LIST id where :MON = id.PERIO group by id.PERIO,id.WERKS,id.MATNR ";
	Table t = KSQL.select(sqls, var, dataModel, null);

	Iterator<Row> row = t.iterator();

	Map<String, List<String[]>> importTableParam = new HashMap<String, List<String[]>>();
	String[] str;// = new String[2]
	List<String[]> list;

	while (row.hasNext()) {
		Row re = row.next();
		String CONSUMPTION = "";

		if (re.getDecimal("CONSUMPTION") != null) {
			CONSUMPTION = re.getDecimal("CONSUMPTION").toString();
		}

		String PERIO = re.getString("PERIO");
		String WERKS = re.getString("WERKS");
		String MATNR = re.getString("MATNR");

		String sun = PERIO + "," + MATNR;
		list = importTableParam.get(sun);
		// ---------------
		if (list == null) {
			list = new ArrayList<String[]>();
			importTableParam.put(sun, list);
		}
		str = new String[2];
		str[0] = WERKS;
		str[1] = CONSUMPTION;

		list.add(str);
		// ----------------
	}

	Iterator<String> keys = importTableParam.keySet().iterator();
	String concept = "REQUIREMENTS_SHEET";

	int batchcount = 5000;
	int index = 0;
	String preparSql = "(FID,VERSION,MATNR,MON,DEMAND_1100,DEMAND_1200,DEMAND_1300,DEMAND_1400,DEMAND_1500,DEMAND_9100) VALUES(?,?,?,?,?,?,?,?,?,?)";
	String updaSql = "MATNR = ?,MON = ?,DEMAND_1100 = ?,DEMAND_1200 = ?,DEMAND_1300 = ?,DEMAND_1400 = ?,DEMAND_1500 = ?,DEMAND_9100 = ? where FID = ? ";
	try {

		Connection conn = ModelUtils.getConnectionInTransaction(dataModel);
		String insertSql = "INSERT INTO " + concept + " " + preparSql;
		String updateSql = "UPDATE " + concept + " SET " + updaSql;
		PreparedStatement insertps = null;
		PreparedStatement update = null;

		insertps = conn.prepareStatement(insertSql);
		update = conn.prepareStatement(updateSql);

		while (keys.hasNext()) {
			index++;
			String key = keys.next();
			String[] k = key.split(",");
			String PERIO = k[0];
			String MATNR = k[1];
			String a = "0";

			list = importTableParam.get(key);

			String selectSql = "select * from " + concept + " id where id.FID = '" + key + "'";
			Table tab = SQL.select(selectSql, null, dataModel);

			if (tab.size() == 0) {

				for (int i = 0; i < list.size(); i++) {
					String[] values = list.get(i);
					String WERKS = values[0];
					String CONSUMPTION = values[1];

					if ("".equals(CONSUMPTION)) {
						CONSUMPTION = "0";
					}
					insertps.setString(1, key);
					insertps.setInt(2, 0);
					insertps.setString(3, MATNR);
					insertps.setString(4, PERIO);
					BigDecimal w1100 = BigDecimal.ZERO;
					BigDecimal w1200 = BigDecimal.ZERO;
					BigDecimal w1300 = BigDecimal.ZERO;
					BigDecimal w1400 = BigDecimal.ZERO;
					BigDecimal w1500 = BigDecimal.ZERO;
					BigDecimal w9100 = BigDecimal.ZERO;

					if ("1100".equals(WERKS)) {
						w1100 = new BigDecimal(CONSUMPTION);
					}

					if ("1200".equals(WERKS)) {
						w1200 = new BigDecimal(CONSUMPTION);
					}

					if ("1300".equals(WERKS)) {
						w1300 = new BigDecimal(CONSUMPTION);
					} else {
						w1300 = new BigDecimal(0);
					}

					if ("1400".equals(WERKS)) {
						w1400 = new BigDecimal(CONSUMPTION);
					}

					if ("1500".equals(WERKS)) {
						w1500 = new BigDecimal(CONSUMPTION);
					}

					if ("9100".equals(WERKS)) {
						w9100 = new BigDecimal(CONSUMPTION);
					}

					insertps.setBigDecimal(5, w1100);
					insertps.setBigDecimal(6, w1200);
					insertps.setBigDecimal(7, w1300);
					insertps.setBigDecimal(8, w1400);
					insertps.setBigDecimal(9, w1500);
					insertps.setBigDecimal(10, w9100);

				}
			} else {
				a = "1";
				for (int i = 0; i < list.size(); i++) {
					String[] values = list.get(i);
					String WERKS = values[0];
					String CONSUMPTION = values[1];

					if ("".equals(CONSUMPTION)) {
						CONSUMPTION = "0";
					}
					update.setString(1, MATNR);
					update.setString(2, PERIO);
					BigDecimal w1100 = BigDecimal.ZERO;
					BigDecimal w1200 = BigDecimal.ZERO;
					BigDecimal w1300 = BigDecimal.ZERO;
					BigDecimal w1400 = BigDecimal.ZERO;
					BigDecimal w1500 = BigDecimal.ZERO;
					BigDecimal w9100 = BigDecimal.ZERO;

					if ("1100".equals(WERKS)) {
						w1100 = new BigDecimal(CONSUMPTION);
					}

					if ("1200".equals(WERKS)) {
						w1200 = new BigDecimal(CONSUMPTION);
					}

					if ("1300".equals(WERKS)) {
						w1300 = new BigDecimal(CONSUMPTION);
					} else {
						w1300 = new BigDecimal(0);
					}

					if ("1400".equals(WERKS)) {
						w1400 = new BigDecimal(CONSUMPTION);
					}

					if ("1500".equals(WERKS)) {
						w1500 = new BigDecimal(CONSUMPTION);
					}

					if ("9100".equals(WERKS)) {
						w9100 = new BigDecimal(CONSUMPTION);
					}

					update.setBigDecimal(3, w1100);
					update.setBigDecimal(4, w1200);
					update.setBigDecimal(5, w1300);
					update.setBigDecimal(6, w1400);
					update.setBigDecimal(7, w1500);
					update.setBigDecimal(8, w9100);
					update.setString(9, key);
				}
			}
			if (a == "0") {
				insertps.addBatch();
				if (index > 0 && index % batchcount == 0) {
					index = 0;
					insertps.executeBatch();
				}
			} else {
				update.addBatch();
				if (index > 0 && index % batchcount == 0) {
					index = 0;
					update.executeBatch();
				}
			}

		}
		update.executeBatch();
		update.close();

		insertps.executeBatch();
		insertps.close();
		conn.close();
	} catch (Exception e) {
		e.printStackTrace();
	}
}
```

说明: 数据库连接在有异常的时候, 关闭不上, 导致内存泄漏, 自定义connection时, 必须在finally中关闭

5. 

错误信息:

```
2017-12-28 17:03:25 [http-8080-5] [com.justep.business.server.BusinessServer] ERROR: excute stream action, params:{"accept":"application/json",
"action":"updateSapD_PAYMENTAction","actionFlag":"__action_0__","activity":"mainActivity","contentType":"json","executeContext":"","executor":"",
"parameters":{"args":[{"ALLOT":"","ITEM_TEXT":"yhby2017120020","SNUM":"99"},{"ALLOT":"40040305","ITEM_TEXT":"收蛋白粉款"},{"ALLOT":"40040305","ITEM_TEXT":"收蛋白粉款"}],
"fID":"682D49DB959440D6937F834CE8397B40"},"process":"/eppenpf/sd/process/sd_payment/sd_paymentProcess"}
java.lang.reflect.InvocationTargetException
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:497)
	at com.justep.system.action.Engine.invokeActions(Native Method)
	at com.justep.system.action.Engine.invokeActions(Unknown Source)
	at com.justep.business.server.BusinessServer.doAction(Unknown Source)
	at com.justep.business.server.BusinessServer.doExcute(Unknown Source)
	at com.justep.business.server.BusinessServer.excute(Unknown Source)
	at com.justep.business.server.BusinessServer.excute(Unknown Source)
	at com.justep.business.server.BusinessServerServlet.execService(Unknown Source)
	at com.justep.business.server.BusinessServerServlet.service(Unknown Source)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:723)
	at com.justep.x.bs.BusinessServerServlet.service(Unknown Source)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:723)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)
	at com.googlecode.psiprobe.Tomcat60AgentValve.invoke(Tomcat60AgentValve.java:40)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:103)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:293)
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:861)
	at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:606)
	at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:489)
	at java.lang.Thread.run(Thread.java:745)
Caused by: java.lang.NullPointerException
	at SDPayment.updateSapD_PAYMENTAction(SDPayment.java:964)
	... 28 more
```

代码信息: 

```
public static Map<String, Object> updateSapD_PAYMENTAction(String fID, List args) throws JCoException {
	System.out.println(args);

	Map<String, Object> result = new HashMap<String, Object>();
	result.put("flag", false);
	result.put("message", "操作失败");

	try {
		Map<String, List<Map<String, Object>>> importTableParams = new HashMap<String, List<Map<String, Object>>>();
		List<Map<String, Object>> tables = new ArrayList<Map<String, Object>>();
		Map<String, Object> tableMap1 = new HashMap<String, Object>();

		String dataModel = "/eppenpf/sd/data";
		HashMap<String, Object> vers = new HashMap<String, Object>();
		vers.put("fid", fID);
		// 查询子表填充
		String sql1 = "select purchase.* from D_PAYMENT purchase where purchase = :fid ";
		Table maintable = KSQL.select(sql1, vers, dataModel, null);
		Iterator<Row> mainRows = maintable.iterator();
		while (mainRows.hasNext()) {

			Row rw = mainRows.next();
			tableMap1.put("BELNR", rw.getString("PAYING_CODE"));
			tableMap1.put("BUZEI", "99");
			// 公司代码
			tableMap1.put("BUKRS", rw.getString("COMP_CODE"));
			// 会计年度
			tableMap1.put("GJAHR", rw.getInt("FISC_YEAR"));
			// 项目文本

			for (Object arg : args) {
				Map entry = (Map) arg;
				String snum = entry.get("SNUM").toString();  // SDPayment.java:964
				String ITEM_TEXT = entry.get("ITEM_TEXT").toString();
				if (snum.equals("99")) {
					tableMap1.put("ITEM_TEXT", ITEM_TEXT);
				}
			}
			tables.add(tableMap1);
			String sql2 = " select detail.* from D_PAYMENT_DETAIL detail where detail.PAY_ID = :fid ";
			Table tableDetail = KSQL.select(sql2, vers, dataModel, null);
			Iterator<Row> rowsDetail = tableDetail.iterator();
			while (rowsDetail.hasNext()) {
				Map<String, Object> tableMap2 = new HashMap<String, Object>();
				Row rw2 = rowsDetail.next();
				tableMap2.put("BELNR", rw.getString("PAYING_CODE"));
				tableMap2.put("BUZEI", rw2.getString("SNUM"));
				// 公司代码
				tableMap2.put("BUKRS", rw.getString("COMP_CODE"));
				// 会计年度
				tableMap2.put("GJAHR", rw.getInt("FISC_YEAR"));
				// 凭证类型
				tableMap2.put("BSCHL", rw2.getString("PK"));
				// 项目文本
				

				for (Object arg : args) {

					Map<?, ?> entry = (Map) arg;
					String snum = entry.get("SNUM").toString();
					String SGTXT = entry.get("ITEM_TEXT").toString();
					String ALLOT = entry.get("ALLOT").toString();
					if (snum.equals(rw2.getString("SNUM"))) {
						tableMap2.put("ITEM_TEXT", SGTXT);
						tableMap2.put("ALLOC_NMBR", ALLOT);
					}
				}

				tables.add(tableMap2);
			}
		}
		importTableParams.put("ET_ACC_DOC_TXT", tables);
		ParameterList exportParams = SapUtils.requestSap("Z_SD_ACC_DOC_TXT_EDIT", new HashMap<String, Object>(), importTableParams);
		// 上传成功，返回凭证号

		String message = exportParams.getString("E_MESSAGE");
		String type = exportParams.getString("E_RETURN");
		if ("E".equals(type) == false) {
			result.put("flag", true);
		} else {
			result.put("message", message);
		}

	} catch (JCoException e) {
		e.printStackTrace();
	}
	return result;
}
```

原因: entry.get("SNUM")为空而报异常(HashMap中允许键值可以为null)
说明: 
  * 变量在使用函数的时候, 必须进行判断是否为空
  * System.out.println(args); 不应该出现在正式代码中
  * e.printStackTrace(); 不是正确的处理异常方式

6.

错误信息:

```
com.justep.model.exception.ModelException: 编码: JUSTEP151005; 提示: 定义Activity "/eppenpf/sd/process/sd_saleOrder/sd_saleOrderProcess,mainActivity"出错, 
"/eppenpf/sd/process/sd_saleOrder/sd_saleOrderProcess,mainActivity"中不存在Action "checkStoreOnChangeAction"
	at com.justep.model.exception.ModelException.create(Unknown Source)
	at com.justep.model.impl.ActivityImpl.getAction(Unknown Source)
	at com.justep.system.action.Engine.invokeActions(Native Method)
	at com.justep.system.action.Engine.invokeActions(Unknown Source)
	at com.justep.business.server.BusinessServer.doAction(Unknown Source)
	at com.justep.business.server.BusinessServer.doExcute(Unknown Source)
	at com.justep.business.server.BusinessServer.excute(Unknown Source)
	at com.justep.business.server.BusinessServer.excute(Unknown Source)
	at com.justep.business.server.BusinessServerServlet.execService(Unknown Source)
	at com.justep.business.server.BusinessServerServlet.service(Unknown Source)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:723)
	at com.justep.x.bs.BusinessServerServlet.service(Unknown Source)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:723)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)
	at com.googlecode.psiprobe.Tomcat60AgentValve.invoke(Tomcat60AgentValve.java:40)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:103)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:293)
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:861)
	at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:606)
	at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:489)
	at java.lang.Thread.run(Thread.java:745)
```

原因: 没有引用checkStoreOnChangeAction

7.

错误信息:

```
2017-12-28 16:54:18 [http-8080-5] [com.justep.business.server.BusinessServer] ERROR: excute stream action, params:{"accept":"application/json",
"action":"unitConvertAction","actionFlag":"__action_0__","activity":"mainActivity","contentType":"json","executeContext":"","executor":"",
"parameters":{"fromUnit":"kg","materialNo":"000000006000000146","quantity":0.85,"toUnit":"T"},"process":"/eppenpf/sd/process/sd_retailOrder/sd_retailOrderProcess"}
java.lang.reflect.InvocationTargetException
	at sun.reflect.GeneratedMethodAccessor508.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:497)
	at com.justep.system.action.Engine.invokeActions(Native Method)
	at com.justep.system.action.Engine.invokeActions(Unknown Source)
	at com.justep.business.server.BusinessServer.doAction(Unknown Source)
	at com.justep.business.server.BusinessServer.doExcute(Unknown Source)
	at com.justep.business.server.BusinessServer.excute(Unknown Source)
	at com.justep.business.server.BusinessServer.excute(Unknown Source)
	at com.justep.business.server.BusinessServerServlet.execService(Unknown Source)
	at com.justep.business.server.BusinessServerServlet.service(Unknown Source)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:723)
	at com.justep.x.bs.BusinessServerServlet.service(Unknown Source)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:723)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)
	at com.googlecode.psiprobe.Tomcat60AgentValve.invoke(Tomcat60AgentValve.java:40)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:103)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:293)
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:861)
	at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:606)
	at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:489)
	at java.lang.Thread.run(Thread.java:745)
Caused by: com.sap.conn.jco.AbapException: (126) ERROR_IN_APPLICATION: ERROR_IN_APPLICATION Message 094 of class 6R type E, Par[1]: 6000000146, Par[2]: ******
	at com.sap.conn.jco.rt.MiddlewareJavaRfc$JavaRfcClient.execute(MiddlewareJavaRfc.java:1875)
	at com.sap.conn.jco.rt.ClientConnection.execute(ClientConnection.java:1120)
	at com.sap.conn.jco.rt.ClientConnection.execute(ClientConnection.java:953)
	at com.sap.conn.jco.rt.RfcDestination.execute(RfcDestination.java:1465)
	at com.sap.conn.jco.rt.RfcDestination.execute(RfcDestination.java:1435)
	at com.sap.conn.jco.rt.AbapFunction.execute(AbapFunction.java:300)
	at com.eppen.sap.SapUtils.requestSap(SapUtils.java:317)
	at com.eppen.sap.SapUtils.requestSap(SapUtils.java:138)
	at com.eppen.common.stock.StockUtils.unitConvert(StockUtils.java:1994)
	at Stock.unitConvert(Stock.java:1974)
	... 27 more
```

8.生产物料库存报表

错误信息: 

**更新列表：**

* 





**参考文章：**

* [][1]
* [][2]
* [][3]
* [][4]


[1]: 
[2]: 
[3]: 
[4]: 